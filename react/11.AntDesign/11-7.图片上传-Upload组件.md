# 上传接口

请求地址：http://101.132.72.36:5100/api/upload
请求方式：post
表单格式：form-data
表单域名称：imagefile

服务器的响应结果

如果没有错误：

```json
{
    "path": "访问路径"
}
```

如果有错误：

```json
{
    "error": "错误消息"
}
```

# Upload组件

本身不作任何显示，仅提供功能，要显示什么，需要作为该组件的内容传递

**组件使用**

```js
import React, { useState } from 'react';
import { Upload, Icon, message, Spin } from 'antd';
import styles from './index.css';

function Avatar(props, ref) {
  const [isLoading, setIsLoading] = useState(false);

  function handleOnChange(info) {
    const res = info.file.response;
    if (res) { //服务器已经响应了结果
      if (res.path) {
        props.onChange && props.onChange(res.path);
        setIsLoading(false);
      } else {
        message.error(res.error);
      }
    }
  }

  function handleBeforeUpload() {
    setIsLoading(true);
  }

  return (
    <Upload
      accept=".png,.jpg,.jpeg,.gif" //限制上传文件类型
      action="/api/upload" //上传地址
      name="imagefile" //服务器规定的上传字段名
      showUploadList={false} //默认为ture，表示以文件列表上传
      onChange={handleOnChange} 
      beforeUpload={handleBeforeUpload} //上传文件前的回调
      ref={ref} //该组件在From.Item中渲染时，需要ref转发
    >
      <Spin tip="图片上传中..." spinning={isLoading}>
        <div className={styles.avatar}>
          {props.value ? (
            <img src={props.value} alt="" />
          ) : (
            <Icon type="plus" style={{ fontSize: '45px', color: 'slateblue' }} />
          )}
        </div>
      </Spin>
    </Upload>
  );
}

export default React.forwardRef(Avatar);
```

