# 阻止跳转

如果用户正在浏览的页面有文本框等元素并且用户已经填写了内容。

那么，当用户想要从当前页面切换到另一个页面时，我们往往需要给用户一个跳转确认提示。例如（“切换页面会导致清空文本框内容，是否真的要进行跳转 ”）

**细节**

**处理这一情况，我们往往利用`Router`组件自带的`getUserConfirmation`方法，开发者仅仅需要在合适的时候触发阻塞（`history.block()`）即可**

## 封装组件 Prompt

**注意**

**该组件第三方库react-router-dom已经进行了封装，我们直接使用即可**

**这里，自行封装一次以了解其中的原理**

### 不使用通用组件的处理方式

```js
// Page2.js

import React, { Component } from 'react';

export default class Page2 extends Component {
  state = {
    val: '',
  };

  handleBlock = (msg) => { //依据文本框是否有内容，而进行阻塞和取消阻塞 参数msg（文本框中的内容）
    if (msg) {
      this.unBlock = this.props.history.block(msg);
    } else {
      this.unBlock && this.unBlock();
    }
  };

  componentWillUnmount() {
    this.unBlock && this.unBlock();
  }

  render() {
    return (
      <div>
        <textarea
          value={this.state.val}
          onChange={(e) => {
            this.setState({
              val: e.target.value,
            });
            this.handleBlock(e.target.value); //每次文本值变化就调用阻塞处理函数
          }}
        ></textarea>
      </div>
    );
  }
}
```

### 组件封装

```js
// Prompt.js

import { Component } from 'react';
import { withRouter } from 'react-router-dom';

class Prompt extends Component {
  static defaultProps = {
    when: false,   //是否需要阻塞 默认为不需要
    message: '',  //阻塞提示消息 默认为空字符串
  };

  componentDidMount() {   //首次加载 调用阻塞处理函数handleBlock
    this.handleBlock();  
  }

  componentDidUpdate() {  //后续更新 调用阻塞处理函数handleBlock
    this.handleBlock();
  }

  componentWillUnmount() {
    this.unBlock && this.unBlock();
  }

  handleBlock = () => {   //阻塞处理函数 根据属性when的值决定是否需要触发阻塞 阻塞消息为属性message的值
    if (this.props.when) {
      this.unBlock = this.props.history.block(this.props.message);
    } else {
      this.unBlock && this.unBlock();
    }
  };

  render() {
    return null; //无需渲染任何内容
  }
}

export default withRouter(Prompt);
```

### 组件使用

```js
import React, { Component } from 'react';
import Prompt from './Prompt';
// import {Prompt} from 'react-router-dom'

export default class Page2 extends Component {
  state = {
    val: '',
  };

  render() {
    return (
      <div>
        <Prompt
          when={this.state.val !== ''}  //文本框内容为空时，不触发阻塞。其他情况都触发阻塞
          message="跳转页面后会清空所有内容，真的要进行跳转吗"
        />
        <textarea
          value={this.state.val}
          onChange={(e) => {
            this.setState({
              val: e.target.value,
            });
          }}
        ></textarea>
      </div>
    );
  }
}
```

