# path-to-regexp

第三方库：[path-to-regexp](https://www.npmjs.com/package/path-to-regexp)，用于将一个字符串正则（路径正则，path regexp）转换成正则表达式

**利用`path-to-regexp`封装matchPath模块，用于返回一个match对象**



## 封装 matchPath模块

```js
import { pathToRegexp } from 'path-to-regexp';

/**
 * 根据path、pathname、options返回一个match对象 如果没有匹配返回null
 * @param {String} path 路径匹配规则
 * @param {String} pathname 真实的路径
 * @param {Object} options 配置对象 包含属性： exact sensitive strict
 */
export default function matchPath(path, pathname, options) {
  const keys = []; //存储路径匹配规则中的关键字
  const regExp = pathToRegexp(path, keys, mixOptions(options));
  const result = regExp.exec(pathname); //匹配真实地址pathname
  if (!result) {
    return null; //没有匹配返回null
  }
  //匹配
  const groupResult = result.slice(1); //得到匹配的分组结果数组
  const params = createParams(groupResult, keys);
  return {
    isExact: pathname === result[0],
    params,
    path,
    url: result[0],
  };
}

/**
 * 将传入的react-router配置，转换为path-to-regexp的配置
 * @param {Object} options 配置对象
 */
function mixOptions(options) {
  const defaultOptions = {
    sensitive: false,
    strict: false,
    exact: false,
  };
  const finalOptions = { ...defaultOptions, ...options };
  return {
    sensitive: finalOptions.sensitive,
    strict: finalOptions.strict,
    end: finalOptions.exact,
  };
}

/**
 * 根据groupResult和keys，返回一个params对象
 * @param {Array} groupResult 正则匹配分组结果
 * @param {Array} keys 路径匹配规则中的关键字数组
 */
function createParams(groupResult, keys) {
  const params = {};
  for (let i = 0; i < groupResult.length; i++) {
    const value = groupResult[i];
    const key = keys[i].name;
    params[key] = value;
  }
  return params;
}
```





