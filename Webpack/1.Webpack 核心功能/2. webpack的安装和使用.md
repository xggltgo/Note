# webpack的安装和使用

> webpack官网：https://www.webpackjs.com/
> 目前的最新版本：webpack5

## webpack简介

webpack 是基于模块化的打包（构建）工具，它把一切视为模块

它通过一个开发时态的入口模块为起点，分析出所有的依赖关系，然后经过一系列的过程（压缩、合并），最终生成运行时态的文件。

webpack的特点：

- **为前端工程化而生**：webpack致力于解决前端工程化，特别是浏览器端工程化中遇到的问题，让开发者集中注意力编写业务代码，而把工程化过程中的问题全部交给 webpack 来处理
- **简单易用**：支持零配置，可以不用写任何一行额外的代码就使用 webpack
- **强大的生态**：webpack 是非常灵活、可以扩展的，webpack 本身的功能并不多，但它提供了一些可以扩展其功能的机制，使得一些第三方库可以融入到webpack 中
- **基于nodejs**：**由于 webpack 在构建的过程中需要读取文件分析依赖，因此它是运行在node环境中的**
- **基于模块化**：webpack 在构建过程中要分析依赖关系，方式是通过模块化导入语句进行分析的，它支持各种模块化标准，包括但不限于CommonJS、ES Module

## webpack的安装

webpack 通过 npm 安装，它提供了两个包：

- webpack：核心包，包含了 webpack 构建过程中要用到的所有 api
- webpack-cli：提供一个简单的 cli 命令，它调用了 webpack 核心包的 api，来完成构建过程

安装方式：

- 全局安装：可以全局使用 webpack 命令，但是无法为不同项目对应不同的 webpack 版本
- **本地安装**：推荐，每个项目都使用自己的 webpack 版本进行构建

```sh
npm i -D webpack webpack-cli
```

## webpack的使用

### 命令行

```shell
# 安装 webpack webpack-cli 即可使用如下命令进行打包：
npx webpack 
```

默认情况下，webpack会以```./src/index.js```作为入口文件分析依赖关系，打包到```./dist/main.js```文件中

通过--mode选项可以控制webpack的打包结果的运行环境（默认使用生产环境进行打包）

- `--mode=development`：表示目前是开发环境下进行打包，是用于测试查看效果。打包合并后的`js`文件结构清晰，且附有注释。
- `--mode=production`：表示目前是生产环境下进行打包，一般在项目上线时使用。打包合并后的`js`文件被压缩，没有注释。
- `--watch`：监控src目录下文件的变化、文件变化后会重新打包

### package.json脚本

```json
{
  "name": "use-webpack",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "build": "webpack --mode=production",
    "dev":"webpack --mode=development"
  },
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "webpack": "^4.46.0",
    "webpack-cli": "^3.3.12"
  }
}
```

## 思考

> 为什么可以使用 ES Module 的方式导入使用 CommonJS 导出的第三方库，例如Jquery？
>
> 因为在 webpack 的打包结果中，模块化语句不复存在，webpack 使用普通函数实现了相同的功能。

> webpack 为什么不能使用与 Vite 类似的方式（利用ES Module动态导入模块并实时编译）？
>
> 因为 webpack 是基于 nodejs 环境，它需要读取文件来分析依赖关系。