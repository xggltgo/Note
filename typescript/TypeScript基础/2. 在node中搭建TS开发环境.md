# 在node中搭建TS开发环境

## 安装TypeScript

全局安装typescript

```sh
npm i -g typescript # 全局安装typescript（typescript包中包含编译的命令行工具 tsc）
```

编译ts文件
```sh
tsc 文件名 # tsc index.ts(默认会在相同目录生成对应的js文件 index.js)
```

**默认情况下，TS会做出下面几种假设：**

1. 假设当前的执行环境是浏览器环境（“DOM”）
2. 如果代码中没有使用模块化语句（import、export），便认为该代码是全局执行
3. 编译的结果所使用的代码版本是es3

**有两种方式更改以上假设：**

1. 使用tsc命令行的时候，加上选项参数
2. **使用ts配置文件，更改编译选项**（常用）

## TS的配置文件

添加TS配置文件的方式：

1. 手动创建tsconfig.json文件
2. 使用命令行语句自动生成tsconfig.json文件 `tsc --init`

**注意：**

在使用了TS配置文件后，使用tsc进行编译时，不能跟上文件名，如果跟上文件名，会忽略配置文件

**tsconfig.json**

```json
{
  "compilerOptions": {
    //编译选项
    "target": "ES2016", //配置编译结果所使用的代码的版本标准
    "module": "CommonJS", //配置编译结果所使用的模块化标准
    "lib": ["ES2016"], //配置ts可使用的全局环境 默认会有 "DOM" (浏览器环境) 此处没有node环境可供配置
    "outDir": "./dist", //配置编译结果的输出目录
  },
  "include": ["./src"], //配置需要编译的文件夹
  // "files": ["./src/index.ts"] //若不是需要编译整个文件夹，而是文件夹中特定的文件，则使用此配置（此配置会编译所配置的文件及其依赖的文件，类似于入口模块）
}
```

**注意：由于ts配置文件中没有配置node环境全局变量的选项，因此需要额外安装`@types/node`库，以向ts加入node环境的全局变量**

```shell
npm i -D @types/node
```

> @types是一个ts官方的类型库，其中包含了很多对js代码的类型描述。
>
> 我们在使用ts时，如果需要使用其他第三方库，可以考虑到@types库中去寻找是否存在对应的增加了类型检查的第三方库。
>
> 例如：
>
> - JQuery：用js写的，没有类型检查
>
> - 安装@types/jquery（为jquery添加了类型定义）

## 简化编译运行流程

>  ts-node：将ts代码在内存中完成编译，同时完成运行   

全局安装ts-ndoe

```sh
npm i -g ts-node #全局安装ts-ndoe
```

编译ts文件

```sh
ts-node 文件名 # ts-node .\src\index.ts
```

> nodemon：用于检测文件的变化

全局安装nodemon

```sh
npm i -g nodemon # 全局安装nodemon
```

nodemon使用

```sh
nodemon --exec ts-node .\src\index.ts #当文件变化时，执行 ts-node .\src\index.ts 命令
nodemon -e ts --exec ts-node ./src/index.ts #仅当扩展名为ts的文件变化时，执行 ts-node .\src\index.ts 命令
nodemon --watch src -e ts --exec ts-node ./src/index.ts #仅当src文件夹下扩展名为ts的文件变化时，执行 ts-node .\src\index.ts 命令
```

**后续开发环境编译使用nodemon，生成环境编译使用tsc：**

**package.json** 

```json
{
  "name": "node_ts",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "build":"tsc",  
    "dev": "nodemon --watch src -e ts --exec ts-node ./src/index.ts"
  },
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@types/node": "^18.11.0"
  }
}
```















