# Ref转发

## 使用场景

## 使用方式

**React.forwardRef()**

```jsx
const NewComp = React.forwardRef(Comp);
```

参数`Comp`:只能传递函数组件，不能是类组件，**函数组件的第二个参数即为转发的ref对象**

返回值`NewComp` :返回一个新的组件（类似于一个高阶组件） 

- 传递给新组件`NewComp`的属性会被传递到`Comp`组件，即`Comp`组件的第一个参数props中
- 传递给新组件`NewComp`的ref会被传递到`Comp`组件，**即`Comp`组件的第二个参数ref中**

----------

### 函数组件

**app.js**

```js
import React, { Component } from 'react';
import Comp from './Comp';

const NewComp = React.forwardRef(Comp);

export default class App extends Component {

  CompRef = React.createRef()

  componentDidMount() { 
    console.log(this.CompRef.current);
   }

  render() {
    return (
      <div>
        <NewComp name='xgglt' ref={this.CompRef} />
      </div>
    );
  }
}
```

**注意`Comp`组件中的使用方式**

**Comp.js**

```js
import React from 'react'

export default function Comp(props,ref) {
  return (
    <div>
      <h1 ref={ref}>Comp</h1>
      <h3>{props.name}</h3>
    </div>
  )
}
```

### 类组件（灵活处理）

#### 使用普通属性传递ref

**app.js**

```js
import React, { Component } from 'react';
import Comp from './Comp';

export default class App extends Component {
  CompRef = React.createRef();

  componentDidMount() {
    console.log(this.CompRef.current);
  }

  render() {
    return (
      <div>
        <Comp name="xgglt" forwardRef={this.CompRef} />
      </div>
    );
  }
}
```

**Comp.js**

```js
import React, { Component } from 'react';

export default class Comp extends Component {
  render() {
    return (
      <div>
        <h1 ref={this.props.forwardRef}>Comp</h1>
        <h3>{this.props.name}</h3>
      </div>
    );
  }
}
```



#### 利用React.forwardRef()灵活处理

**app.js**

```js
import React, { Component } from 'react';
import Comp from './Comp';

const NewComp = React.forwardRef((props, ref) => {
  return <Comp {...props} forwardRef={ref} />;
});

export default class App extends Component {
  CompRef = React.createRef();

  componentDidMount() {
    console.log(this.CompRef.current);
  }

  render() {
    return (
      <div>
        <NewComp name="xgglt" ref={this.CompRef} />
      </div>
    );
  }
}
```

**Comp.js**
```js
import React, { Component } from 'react';

export default class Comp extends Component {
  render() {
    return (
      <div>
        <h1 ref={this.props.forwardRef}>Comp</h1>
        <h3>{this.props.name}</h3>
      </div>
    );
  }
}
```

## 使用场景

> 我们在使用HOC返回的高阶组件时，想要使用返回的高阶组件内部的组件的组件实例对象的某些方法，此时需要将ref绑定到内部组件上

使用高阶组件`WithLogined`返回的新组件`NewComp`时，想要调用`Comp`组件实例对象上的方法,通过在高阶组件`WithLogined`中进行**ref转发**

**app.js**

```js
import React, { Component } from 'react';
import Comp from './Comp';
import WithLogined from './HOC/WithLogined';

const NewComp = WithLogined(Comp);
export default class App extends Component {
  CompRef = React.createRef();

  componentDidMount() {
    this.CompRef.current.print();
  }

  render() {
    return (
      <div>
        <NewComp isLogined name="xgglt" ref={this.CompRef} />
      </div>
    );
  }
}
```

高阶组件`WithLogined`进行ref转发处理

**WithLogined.js**

```js
import React, { Component } from 'react';

export default function WithLogined(Comp) {
  class LoginedWrapper extends Component {
    render() {
      const {isLogined,forwardRef,...rest} = this.props;
      if (isLogined) {
        return <Comp {...rest} ref={forwardRef} />;
      } else {
        return null;
      }
    }
  };

  return React.forwardRef((props,ref)=>{
    return <LoginedWrapper {...props} forwardRef={ref} />;
  })
}

```
**Comp.js**
```js
import React, { Component } from 'react';

export default class Comp extends Component {
  print = () => {
    console.log('print');
  };

  render() {
    return (
      <div>
        <h1>Comp</h1>
        <h3>{this.props.name}</h3>
      </div>
    );
  }
}
```





