## Form

### Form组件

仅提供样式和事件

### form对象

处理数据验证、生成、获取

1. 获取form对象：通过Form.create(配置)得到一个高阶组件，该高阶组件会将form对象作为属性，注入到传递的组件中

- 配置

  - mapPropsToFields 配置表单数据信息对象的初始默认值

    ```js
    Form.create({
        mapPropsToFields: props => ({
    			sex:Form.createFormField({
            value:'女'props
          })
        })
    })
    ```

2. 使用form对象

- getFieldDecorator：该方法用于产生一个表单元素，通过该方法产生的表单元素会被form对象控制
  - 参数1：配置为一个字符串，该字符串即为最终提交表单时，形成的表单信息的属性名 *例如：{loginId:…}*
  - 参数2：配置对象；需要扩展功能、修改功能完成需求时可查阅文档 
    - 若需要让没有value属性的Switch(开关)组件受控，则需要更改受控属性配置
    - 配置表单组件的验证规则
    - 配置传入的表单组件受控属性（可能是value）的默认值（但不推荐在此处配置默认值，而是在Form.create(配置)的配置中）
  - 该函数返回一个高阶组件，用于包装antd提供的表单组件（文本框、单选框等）；该高阶组件内部会使传入的表单组件变成受控组件，其本质上控制的是传入的表单组件的value属性和onChange事件。
- getFieldsValue：表单提交时，调用该方法可以或许最终收集到的表单数据对象
- validateFields：调用该方法会对表单中的各个表单组件配置的验证规则进行验证
  - 该方法需要传入一个回调函数，该回调函数有两个参数（error：验证错误信息，values：表单数据对象）



### 组件使用

```js
import React, { Component } from 'react';
import { Form, Input, Button, Radio, Switch, DatePicker, Select } from 'antd';
const { Option } = Select;

class MovieForm extends Component {
  handleSubmit = e => {
    e.preventDefault();
    this.props.form.validateFields((err, val) => {
      if (!err) {
        console.log(val);
      }
    });
  };

  render() {
    const { getFieldDecorator } = this.props.form;
    return (
      <Form
        labelCol={{
          span: 8,
        }}
        wrapperCol={{
          span: 8,
        }}
        onSubmit={this.handleSubmit}
      >
        <Form.Item label="账号">
          {getFieldDecorator('loginId', {
            rules: [{ required: true, message: '账号不能为空' }],
          })(<Input />)}
        </Form.Item>
        <Form.Item label="密码">
          {getFieldDecorator('loginPwd', {
            rules: [
              { required: true, message: '账号不能为空' },
              { min: 6, max: 15, message: '密码长度必须在6-15位之间' },
            ],
          })(<Input.Password />)}
        </Form.Item>
        <Form.Item label="性别">
          {getFieldDecorator('sex')(
            <Radio.Group>
              <Radio.Button value="male">男</Radio.Button>
              <Radio.Button value="female">女</Radio.Button>
            </Radio.Group>,
          )}
        </Form.Item>
        <Form.Item label="会员">
          {getFieldDecorator('vip', {
            valuePropName: 'checked',
          })(<Switch checkedChildren="是" unCheckedChildren="否" />)}
        </Form.Item>
        <Form.Item label="出生日期">{getFieldDecorator('birth')(<DatePicker />)}</Form.Item>
        <Form.Item label="城市">
          {getFieldDecorator('city')(
            <Select style={{ width: 250 }}>
              <Option value="cdc">成都</Option>
              <Option value="cnc">南充</Option>
              <Option value="msc">眉山</Option>
            </Select>,
          )}
        </Form.Item>
        <Form.Item label="邮箱">
          {getFieldDecorator('email', {
            rules: [
              {
                pattern: /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,
                message: '邮箱格式不正确',
              },
            ],
          })(<Input />)}
        </Form.Item>
        <Form.Item
          wrapperCol={{
            offset: 8,
          }}
        >
          <Button htmlType="submit" type="primary">
            提交
          </Button>
        </Form.Item>
      </Form>
    );
  }
}

//为表单字段设置初始值的辅助函数
function initFormField(initConfig) {
  const result = {};
  for (const key in initConfig) {
    result[key] = Form.createFormField({
      value: initConfig[key],
    });
  }
  return result;
}

export default Form.create({
  mapPropsToFields: props =>
    initFormField({
      sex: 'male',
      vip: true,
      city: 'cdc',
    }),
})(MovieForm);
```



